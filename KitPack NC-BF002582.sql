select COUNT(InmostPackageID),u.StatusID,COUNT(u.id)  from ffproductionorder po(nolock) join ffunit u (nolock) on u.ProductionOrderID=po.idjoin ffUnitDetail ud(nolock) on ud.UnitID=u.ID where productionordernumber ='KTP000720'group by u.StatusID  begin tran--Recover KITPACK Statusupdate u set statusid=1 from ffUnit ujoin ffProductionOrder po on po.ID=u.ProductionOrderID where ProductionOrderNumber ='KTP000720'--Rocever APP/CON Statusupdate u2 set statusid=1 from ffUnit ujoin ffUnitComponent uc on uc.UnitID=u.IDjoin ffUnit u2 on u2.ID=uc.ChildUnitIDjoin ffProductionOrder po on po.ID=u.ProductionOrderID where ProductionOrderNumber ='KTP000720'--Active Orderupdate p set statusid=3 from ffProductionOrder p where ProductionOrderNumber ='KTP000720'--Remove Complete ProductionorderDetail QCTest,QCTestPassTime,KP_PO_Completeddelete pod from ffProductionOrder po join ffProductionOrderDetail pod on pod.ProductionOrderID =po.ID join luProductionOrderDetailDef podd on podd.ID =pod.ProductionOrderDetailDefIDwhere po.ProductionOrderNumber ='KTP000720' and podd.Description in ('QCTest','QCTestPassTime','KP_PO_Completed')--select podd.*,pod.Content,po.StatusID from ffProductionOrder po join ffProductionOrderDetail pod on pod.ProductionOrderID =po.ID join luProductionOrderDetailDef podd on podd.ID =pod.ProductionOrderDetailDefIDwhere po.ProductionOrderNumber ='KTP000720'--(42046 rows affected)--(84092 rows affected)update p set statusid=0 from  ffPackage pjoin  ffProductionOrder po  on po.ID=p.CurrProductionOrderID where ProductionOrderNumber ='KTP000720'rollbackbegin tranupdate pp set hashcode=hashcode+'_' from udtKitPackEOB_APILog  ppjoin ffProductionOrder po on po.ID=pp.ProductionOrderIDwhere po.ProductionOrderNumber ='KTP000720'rollback